<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Margarita Leonova | Home</title>

    <!--stylesheet placeholder-->
    <link href="styles.css" rel="stylesheet" />

    <style>
        .banner-subheading {
            color: #6e7de4
        }
    </style>
</head>

<body>
    <!--HEADER-->
    <header>
        <!-- LOGO -->
        <div id="nav-logo">&nbsp;ML</div>
        <div id="nav-blub"></div>

        <label for="checkbox" id="hamburger-menu">
            <svg viewBox="0 0 100 75" width="40" height="28">
                <rect width="85" height="15" rx="10"></rect>
                <rect y="30" width="85" height="15" rx="10"></rect>
                <rect y="60" width="85" height="15" rx="10"></rect>
            </svg>
        </label>
        <input type="checkbox" id="checkbox" name="checkbox">

        <ul id="nav-menu">
            <li><a href="index.html#">Home</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#my-projects">Projects</a></li>
            <li><a href="index.html#my-skills">Skills</a></li>
            <li><a href="index.html#contact-me">Contact</a></li>
        </ul>
    </header>

    <main>

        <!--PROJECTS SECTION-->
        <section id="project">
            
            <h1 class="section-header">Shadow mapping with Projective Transformations</h2>
            <h3 class="projects-subheader">Goal</h3>
            <p>
                The main goal of this project was to implement a more realistic scene by using shadow mapping to cast
                shadows and projective transformations to help transform a scene as view point changes. "Two pass"
                shadow mapping algorithm is used for rendering the scene. The first pass renders the scene form the
                lightâ€™s point of view, and the second pass renders the scene from its original model view. On the first
                pass, we must store the depth information of the scene (in particular all the objects that are present
                in the scene), and we use this information in the second pass to calculate shadows by comparing the
                depth information that we obtained during the first pass to the current depth information.
            </p>

            <h3 class="projects-subheader">Implementation</h3>
            <p>The first step of this process is to set up depth shaders. The purpose of these shaders is to help store
                and calculate the depth of the shadows. gl_FragCoord can be used to obtain z coordinate (out of x, y, z
                coordinates) which represents depth information between the light source and the surface of the object
                that obstructs the light) and can be linearized to get a better approximation.</p>
            <p>Next, we want to obtain view, model, projection, and position matrices. To do that we can use matrix
                transformation techniques such as rotation and projection as well as some basic multiplication to
                transform the modelview matrix into four separate matrixes. Now we're ready to calculate our new
                viewpoint position by multiplying projection, view, model and position matrices together.</p>
            <p>Next, we want to set up depth map and frame buffer object to verify if the depth shader is working as
                intended. After creating frame buffer object in light.cpp and rendering the scene we can see a depth map
                output.</p><br>

            <p>The next task is to transform the light direction from the world space (the way the scene is positioned
                with respect to the world coordinates x, y, and z) to the light space (view scene from the prospective
                of the light source, in our case the light source is the sun) by writing custom lighting functions. We
                need to implement two draw functions, one for the depth shader and one for the surface shader. Before
                drawing, we calculate a view light space and a projection light space matrix which would allow us later
                to render the scene twice from two different perspectives. When building our scene we set the
                corresponding shaders to the light space view matrix and projection matrix:</p>
            <pre>
                shader->viewLS=lookAt(vec3(light["sun"]->position), camera->up, vec3(0.0f, 1.0f, 0.0f));
                shader->projLS=ortho(-1.9f, 1.9f, -1.9f, 1.9f, 1.0f, 8.0f);
            </pre>

            <p>The last task is to calculate the shadows. To do so, we needed a two pass algorithm allowing us to render
                the scene once to store the depth information from the light's perspective, and again from the regular
                viewing perspective which will allow us to compare the depth values between both perspectives. Now when
                calculating our local illumination we will be able to calculate the shadows at the same time:</p>
            <aside>
                <p>Snippet of code for shadow mapping calculation</p>
            </aside>
            <pre>
                    ShadowCalculation(posLS, lightDir, normalCam) {
                        projCoord = posLS.xyz / posLS.w;
                        projCoords = projCoords * 0.5 + 0.5;
                        closestDepth = texture(shadowMap, projCoords.xy).r;
                        currentDepth = projCoords.z;
                        bias = max(0.05 * (1.0-dot(normal, lightDir)), 0.005);
                        shadow = currentDepth-bias > closestDepth ? 1.0:0.0;
                        return shadow;
                    }
                </pre>

            <p>Once the shadow has been calculated we are able to multiply it to the diffuse and specular components of
                the Blinn-Phong model. We use Blinn-Phong model to eliminate aliasing and produce a more clear picture
                of the shades. Below are pictures of the result. Picture on the left shows a scene without shadows and
                picture on the right shows a scene with shadows.</p>

            <h3 class="projects-subheader">Result</h3>
            <div class="projects-images">

                <picture>
                        <source srcset="images/shadow-mapping-4-large.png" media="(min-width: 85em)">
                        <source srcset="images/shadow-mapping-4-medium.png" media="(min-width: 40em)">
                        <img src="images/shadow-mapping-4-small.png" alt="A description of the image." loading="lazy"
                            decoding="async">
                </picture>

            </div>

        </section>

    </main>

    <!--FOOTER-->
    <footer>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
            <path fill="#fe8d88"
                d="M0,128L80,122.7C160,117,320,107,480,133.3C640,160,800,224,960,229.3C1120,235,1280,181,1360,154.7L1440,128L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z">
            </path>
            <text x="50%" y="85%" text-anchor="middle">With &#10084; by Margarita Leonova</text>
        </svg>
    </footer>
</body>

</html>
